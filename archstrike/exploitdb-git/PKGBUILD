# Maintainer: ArchStrike <team@archstrike.org>

buildarch=1

pkgname=exploitdb-git
pkgver=20160915.r972
pkgrel=1
groups=('archstrike' 'archstrike-exploit')
pkgdesc="The official Exploit Database repository"
arch=('any')
url='https://github.com/offensive-security/exploit-database'
license=('GPL')
depends=('bash')
makedepends=('git')
options=('!strip')
replaces=('exploit-db')
conflicts=('exploit-db')
provides=('exploit-database' 'exploit-db' 'exploitdb')
source=("${pkgname}::git+https://github.com/offensive-security/exploit-database.git")
sha512sums=('SKIP')

pkgver() {
  cd "${pkgname}"
  printf "%s.r%s" "$(git show -s --format=%ci master | sed 's/\ .*//g;s/-//g')" "$(git rev-list --count HEAD)"
}

package() {
  cd "${pkgname}"
  install -dm755 "${pkgdir}/usr/bin"
  install -dm755 "${pkgdir}/usr/share/${pkgname}/platforms"
  cp -a --no-preserve=ownership platforms/* "${pkgdir}/usr/share/${pkgname}/platforms"
  install -m644 "README.md" "${pkgdir}/usr/share/${pkgname}/README.md"
  install -m644 "files.csv" "${pkgdir}/usr/share/${pkgname}/files.csv"
  install -m755 "searchsploit" "${pkgdir}/usr/share/${pkgname}/searchsploit"

cat > "${pkgdir}/usr/bin/searchsploit" <<EOF
#!/usr/bin/env bash
cd /usr/share/${pkgname}
./searchsploit "\$@"
EOF
chmod 755 "${pkgdir}/usr/bin/searchsploit"
}
