# Maintainer: ArchStrike <team@archstrike.org>
# Contributor: Michael DÃ¼ll <michael.duell@rub.de>
# Contributor: Dalton Miller

buildarch=192

pkgname=b2sum-git
pkgver=20140711.r15
pkgrel=1
pkgdesc="Utility to calculate BLAKE2 checksums written in Go."
arch=('i686' 'x86_64')
url="https://github.com/dchest/b2sum"
groups=('archstrike' 'archstrike-misc')
license=('custom')
depends=('bash')
makedepends=('go' 'git')
replaces=('b2sum')
provides=('b2sum')
conflicts=('b2sum')
source=("$pkgname::git+https://github.com/dchest/b2sum.git")
sha512sums=('SKIP')

pkgver() {
  cd $pkgname
  printf "%s.r%s" "$(git show -s --format=%ci master | sed 's/\ .*//g;s/-//g')" "$(git rev-list --count HEAD)"
}

build() {
  cd $pkgname
  GOPATH="$srcdir" go get -d -t bitbucket.org/dchest/b2sum
}

package() {
  cd $pkgname
  GOPATH="$srcdir" go build -v bitbucket.org/dchest/b2sum
  install -dm755 "$pkgdir/usr/bin"
  install -dm755 "$pkgdir/usr/share/licenses/$pkgname"
  install -dm755 "$pkgdir/usr/share/$pkgname"
  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  cp -a --no-preserve=ownership * "$pkgdir/usr/share/$pkgname"

cat > "$pkgdir/usr/bin/b2sum" << EOF
#!/bin/sh
/usr/share/$pkgname/./b2sum "\$@"
EOF
chmod +x "$pkgdir/usr/bin/b2sum"
}
  
