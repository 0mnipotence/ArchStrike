# Maintainer: ArchStrike <team@archstrike.org>

buildarch=220

pkgname=bro
pkgver=2.6.1
pkgrel=1
pkgdesc="A highly configurable IDS"
arch=('i686' 'x86_64' 'armv6h' 'armv7h' 'aarch64')
url="http://bro-ids.org/"
backup=(etc/bro/{broccoli.conf,broctl.cfg,networks.cfg,node.cfg})
license=('BSD')
depends=('curl' 'file' 'geoip' 'gperftools' 'ipsumdump' 'postfix'
         'bind-tools' 'openssl' 'libpcap' 'bash' 'python2' 'zlib')
makedepends=('cmake' 'swig' 'bison' 'flex')
install=${pkgname}.install
groups=('archstrike' 'archstrike-networking')
options=('!emptydirs')
source=("https://www.zeek.org/downloads/bro-$pkgver.tar.gz" "$install")
sha512sums=('18ce8efd12226b4aea962034b68f14202b03f64d2cd0c2feab354ae84160d36fd2ec94343c0f816e25aa7903e7670cf9f69cac48db75f645ee641d58af2b2f28'
            '4b8cc874148b9a640809420950d07b3f9ffe1c16a5fe145c85c17fa2f2a8f023a96370e810c895a5fab173cc9d32908ad0b8e603ae8a3206d52ed65f179bec00')

build() {
  cd $srcdir/$pkgname-$pkgver
  ./configure --prefix="/usr" --conf-files-dir="/etc/bro" --spooldir="/usr/share/bro" \
  --logdir="/usr/share/bro/logs" --localstatedir="/var/spool" --with-python=/usr/bin/python2 \
  --enable-mobile-ipv6
  make DESTDIR="$pkgdir"
}

package() {
  cd $srcdir/$pkgname-$pkgver
  mkdir -p $pkgdir/usr/share/bro/logs
  make DESTDIR="$pkgdir/" install
  install -Dm644 COPYING $pkgdir/usr/share/licenses/$pkgname/COPYING
  find "${pkgdir}" -type f | xargs sed -i "/# This file was automatically generated by bifcl/d"
  find "${pkgdir}" -type f | xargs sed -i 's|/usr/bin/env python|/usr/bin/env python2|'
}
